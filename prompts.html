<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompts - BD Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 {
            color: #333;
        }
        .prompt-card {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #9b59b6;
        }
        .prompt-text {
            background-color: #f1e5f9;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        .button {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin-right: 10px;
        }
        .copy-button {
            background-color: #9b59b6;
            cursor: pointer;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #777;
        }
        .error {
            color: #e74c3c;
            padding: 10px;
            background-color: #fadbd8;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .copied {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BD Creator - Prompts</h1>
        
        <div class="navigation">
            <p>
                <a href="index.html" class="button">Accueil</a>
                <a href="scenario.html" class="button">Scénario</a>
                <a href="storyboard.html" class="button">Storyboard</a>
            </p>
        </div>
        
        <div id="prompts-container">
            <h2 id="chapter-title">Prompts pour le chapitre : <span id="chapter-name">Chargement...</span></h2>
            <p>Voici les prompts générés pour Midjourney pour chaque case du storyboard. Vous pouvez les copier et les utiliser directement dans Midjourney pour créer les images de votre BD.</p>
            
            <div id="prompts-content" class="loading">
                Chargement des prompts...
            </div>
        </div>
    </div>

    <script>
        // Fonction pour récupérer les paramètres de l'URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Fonction pour copier le texte dans le presse-papiers
        function copyToClipboard(text, buttonElement) {
            navigator.clipboard.writeText(text).then(function() {
                // Changer le texte du bouton temporairement
                const originalText = buttonElement.textContent;
                buttonElement.textContent = "Copié !";
                buttonElement.classList.add("copied");
                
                // Rétablir le texte original après 2 secondes
                setTimeout(function() {
                    buttonElement.textContent = originalText;
                    buttonElement.classList.remove("copied");
                }, 2000);
            }, function(err) {
                console.error('Erreur lors de la copie: ', err);
                alert("Erreur lors de la copie. Veuillez sélectionner et copier manuellement.");
            });
        }

        // Fonction pour convertir une description en prompt Midjourney
        function descriptionToPrompt(description, chapterId, pageNum, caseNum) {
            // Extraire les éléments clés de la description
            const keywords = extractKeywords(description);
            
            // Déterminer le style en fonction du chapitre
            let style, mood, lighting;
            
            switch(parseInt(chapterId)) {
                case 1: // Le Début du Voyage
                    style = "style de bande dessinée européenne, ligne claire";
                    mood = "mystérieux, plein de curiosité";
                    lighting = "lumière douce, lueurs mystérieuses";
                    break;
                case 2: // Rencontres Inattendues
                    style = "style manga détaillé, encre noire";
                    mood = "tension, méfiance, nouvelles alliances";
                    lighting = "contrastes marqués, ombres dramatiques";
                    break;
                case 3: // L'Épreuve du Feu
                    style = "style dramatique, couleurs chaudes";
                    mood = "courage, détermination, adversité";
                    lighting = "éclairage dramatique, tons orangés et rouges";
                    break;
                case 4: // Révélations
                    style = "style mystique, couleurs éthérées";
                    mood = "révélation, compréhension, vérité";
                    lighting = "lumière éthérée, rayons lumineux";
                    break;
                case 5: // Le Dénouement
                    style = "style épique, composition grandiose";
                    mood = "résolution, triomphe, transformation";
                    lighting = "lumière éclatante, aube d'un nouveau jour";
                    break;
                default:
                    style = "style bande dessinée détaillé";
                    mood = "aventure, fantasy";
                    lighting = "éclairage équilibré";
            }
            
            // Construire le prompt en utilisant les éléments de la description
            let prompt = `/imagine ${keywords.join(", ")}, ${mood}, ${style}, ${lighting}, case de bande dessinée, composition dynamique, détails précis --ar 2:3 --v 5.2`;
            
            return prompt;
        }
        
        // Fonction pour extraire les mots-clés importants d'une description
        function extractKeywords(description) {
            // Supprimer les articles et mots courants
            const wordsToRemove = ["le", "la", "les", "un", "une", "des", "du", "de", "notre", "héros", "qui", "que", "avec", "pour", "dans", "sur", "par", "au", "aux", "et", "ou", "à", "se"];
            
            // Convertir la description en mots
            let words = description.toLowerCase().replace(/[.,;:!?]/g, '').split(' ');
            
            // Filtrer les mots courts et les mots à supprimer
            words = words.filter(word => word.length > 2 && !wordsToRemove.includes(word));
            
            // Identifier les groupes de mots importants (noms + adjectifs)
            const importantPhrases = [];
            
            // Analyser la description pour des éléments spécifiques
            if (description.includes("artefact")) importantPhrases.push("ancient artifact");
            if (description.includes("portail")) importantPhrases.push("mystical portal");
            if (description.includes("briller") || description.includes("lumière")) importantPhrases.push("glowing light");
            if (description.includes("silhouette") || description.includes("mystérieuse")) importantPhrases.push("mysterious figure");
            if (description.includes("paysage")) importantPhrases.push("fantasy landscape");
            if (description.includes("alliés") || description.includes("personnage")) importantPhrases.push("diverse characters");
            if (description.includes("créatures")) importantPhrases.push("fantasy creatures");
            if (description.includes("ennemi") || description.includes("masqué")) importantPhrases.push("masked villain");
            if (description.includes("pouvoir")) importantPhrases.push("magical powers");
            if (description.includes("flammes") || description.includes("feu")) importantPhrases.push("wall of fire");
            if (description.includes("combat")) importantPhrases.push("epic battle");
            if (description.includes("pont")) importantPhrases.push("dangerous bridge over chasm");
            if (description.includes("duel")) importantPhrases.push("dramatic duel");
            if (description.includes("bibliothèque")) importantPhrases.push("ancient library");
            if (description.includes("temple")) importantPhrases.push("hidden temple");
            if (description.includes("vision")) importantPhrases.push("mystical vision");
            if (description.includes("prophétie")) importantPhrases.push("ancient prophecy");
            if (description.includes("bataille")) importantPhrases.push("epic battle");
            if (description.includes("choix")) importantPhrases.push("moment of choice");
            
            // Si aucune phrase spécifique n'a été identifiée, utiliser les mots filtrés
            if (importantPhrases.length === 0) {
                // Prendre jusqu'à 5 mots aléatoires parmi les mots filtrés
                const selectedWords = [];
                const shuffledWords = words.sort(() => 0.5 - Math.random());
                for (let i = 0; i < Math.min(5, shuffledWords.length); i++) {
                    selectedWords.push(shuffledWords[i]);
                }
                return selectedWords;
            }
            
            return importantPhrases;
        }

        // Fonction pour générer des prompts Midjourney pour un chapitre
        function generatePrompts(chapterId, chapterTitle) {
            const promptsContent = document.getElementById('prompts-content');
            let html = '';
            
            // Déterminer le nombre de pages en fonction du chapitre
            let pageCount;
            switch(chapterId) {
                case '1': pageCount = 10; break;
                case '2': pageCount = 12; break;
                case '3': pageCount = 8; break;
                case '4': pageCount = 10; break;
                case '5': pageCount = 8; break;
                default: pageCount = 10;
            }
            
            // Générer des prompts pour chaque page et chaque case
            for (let i = 1; i <= pageCount; i++) {
                html += `<h3>Page ${i}</h3>`;
                
                // Nombre de cases par page (entre 3 et 7)
                const caseCount = Math.floor(Math.random() * 5) + 3;
                
                for (let j = 1; j <= caseCount; j++) {
                    // Générer des descriptions fictives basées sur le chapitre
                    let description;
                    
                    if (chapterId == 1) {
                        // Chapitre 1: Le Début du Voyage
                        const descriptions = [
                            "Notre héros observe l'artefact mystérieux avec curiosité.",
                            "L'artefact commence à briller d'une lumière étrange.",
                            "Un portail s'ouvre devant notre héros, révélant un monde inconnu.",
                            "Notre héros hésite devant l'entrée du portail.",
                            "Une silhouette mystérieuse apparaît de l'autre côté du portail.",
                            "Notre héros prend une profonde inspiration et fait un pas en avant.",
                            "Le paysage autour de lui se transforme complètement."
                        ];
                        
                        description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    } 
                    else if (chapterId == 2) {
                        // Chapitre 2: Rencontres Inattendues
                        const descriptions = [
                            "Notre héros rencontre un personnage étrange aux vêtements colorés.",
                            "Un groupe de créatures hostiles apparaît au loin.",
                            "Une femme mystérieuse offre son aide à notre héros.",
                            "Notre héros et ses nouveaux alliés discutent autour d'un feu de camp.",
                            "Un ennemi masqué observe le groupe depuis les ombres.",
                            "Notre héros apprend à utiliser un pouvoir nouvellement découvert.",
                            "Le groupe traverse un paysage fantastique jamais vu auparavant."
                        ];
                        
                        description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    }
                    else if (chapterId == 3) {
                        // Chapitre 3: L'Épreuve du Feu
                        const descriptions = [
                            "Notre héros fait face à un mur de flammes qui bloque le passage.",
                            "Le groupe est encerclé par des ennemis menaçants.",
                            "Notre héros doit traverser un pont suspendu au-dessus d'un gouffre.",
                            "Un duel s'engage entre notre héros et l'antagoniste.",
                            "Notre héros utilise son pouvoir à pleine puissance pour la première fois.",
                            "Un allié tombe au combat, protégeant notre héros.",
                            "Notre héros découvre une vérité bouleversante sur son passé."
                        ];
                        
                        description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    }
                    else if (chapterId == 4) {
                        // Chapitre 4: Révélations
                        const descriptions = [
                            "Notre héros découvre une ancienne bibliothèque contenant des secrets oubliés.",
                            "Un sage révèle la véritable origine de l'artefact.",
                            "Notre héros a une vision du passé qui explique tout.",
                            "L'antagoniste dévoile son vrai visage et ses motivations.",
                            "Notre héros comprend enfin son rôle dans une prophétie ancienne.",
                            "Le groupe découvre un temple caché qui renferme la clé de tout.",
                            "Notre héros retrouve quelqu'un qu'il croyait perdu à jamais."
                        ];
                        
                        description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    }
                    else if (chapterId == 5) {
                        // Chapitre 5: Le Dénouement
                        const descriptions = [
                            "Notre héros se prépare pour l'affrontement final.",
                            "Une bataille épique s'engage entre les forces du bien et du mal.",
                            "Notre héros utilise l'artefact pour refermer la brèche entre les mondes.",
                            "L'antagoniste tente une dernière manœuvre désespérée.",
                            "Notre héros fait un choix qui changera tout.",
                            "Le monde commence à se reconstruire après le chaos.",
                            "Notre héros contemple son avenir, transformé par son voyage."
                        ];
                        
                        description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    }
                    else {
                        // Chapitre par défaut si l'ID n'est pas reconnu
                        description = `Description de la case ${j} (chapitre ${chapterId}, page ${i})`;
                    }
                    
                    // Générer un prompt basé sur la description
                    const promptText = descriptionToPrompt(description, chapterId, i, j);
                    
                    // Échapper les apostrophes pour éviter les problèmes avec l'attribut onclick
                    const escapedPrompt = promptText.replace(/'/g, "\\'");
                    
                    html += `
                    <div class="prompt-card">
                        <h4>Case ${j} - Page ${i}</h4>
                        <p><strong>Description :</strong> ${description}</p>
                        <div class="prompt-text">${promptText}</div>
                        <button class="button copy-button" onclick="copyToClipboard('${escapedPrompt}', this)">Copier le prompt</button>
                    </div>`;
                }
            }
            
            promptsContent.innerHTML = html;
            promptsContent.classList.remove('loading');
        }

        // Fonction principale qui s'exécute au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Récupérer les paramètres de l'URL
            const chapterId = getUrlParameter('chapter');
            const chapterTitle = getUrlParameter('title');
            
            // Mettre à jour le titre avec le numéro et le nom du chapitre
            const chapterNameElement = document.getElementById('chapter-name');
            
            if (chapterId && chapterTitle) {
                chapterNameElement.textContent = `${chapterId}. ${chapterTitle}`;
                
                // Générer les prompts pour ce chapitre
                generatePrompts(chapterId, chapterTitle);
            } else {
                // Afficher un message d'erreur si aucun chapitre n'est spécifié
                const promptsContent = document.getElementById('prompts-content');
                promptsContent.innerHTML = `
                    <div class="error">
                        <p>Erreur : Aucun chapitre spécifié.</p>
                        <p>Veuillez d'abord sélectionner un chapitre depuis la page storyboard.</p>
                    </div>
                    <p><a href="scenario.html" class="button">Retour au scénario</a></p>
                `;
                promptsContent.classList.remove('loading');
                chapterNameElement.textContent = "Non spécifié";
            }
        });
    </script>
</body>
</html>


    
    <script src="js/main.js"></script>
</body>
</html>
